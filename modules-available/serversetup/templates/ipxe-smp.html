<a class="btn btn-default" href="?do=Serversetup&amp;advanced=true" role="button"><strong>{{lang_ipxeAdv}}</strong></a></br></br>
<div class="panel panel-default">
	<div class="panel-heading">
		{{lang_mountIpxe}}
	</div>
	<div class="panel-body">
		<p>{{lang_ipxeSmpInfo}}</p>
		<button id="mount-button" onclick="mountIpxe('iso');" class="btn btn-primary" type="button" data-toggle="modal" data-target="#ipxe-modal" data-backdrop="static">	{{lang_compileIso}}
		</button>
		<button id="mount-button" onclick="mountIpxe('usb');" class="btn btn-primary" type="button" data-toggle="modal" data-target="#ipxe-modal" data-backdrop="static">	{{lang_compileUsb}}
		</button>
    		<br>
	</div>
</div>


<div class="modal fade" id="ipxe-modal" tabindex="-1" role="dialog" aria-labelledby="ipxe-modal-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="ipxe-modal-label">{{lang_compilingIpxe}}</h4>
      </div>
      <div class="modal-body" id="ipxe-modal-body">

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{{lang_cancel}}</button>
        <button id="download-btn" type="button" class="btn btn-primary" disabled="disabled" onclick="downloadIpxe()">{{lang_download}}</button>
      </div>
    </div>
  </div>
</div>

<script>
	function mountIpxe(extension) {
		document.getElementById('ipxe-modal-body').innerHTML = "<div class='alert alert-info' role='alert'>{{lang_ipxeWarning}}</div>"
			+ "{{lang_loading}} <img src='fonts/loader.gif'/>";
		$("#download-btn").prop("disabled",true);
		var xmlhttp = new XMLHttpRequest();
		xmlhttp.open("GET","?do=ServerSetup&async=true&submitTask=true&extension=" + extension,true);
		xmlhttp.onreadystatechange= function() {
			if (xmlhttp.readyState==4 && xmlhttp.status==200) {
				var initResponse = xmlhttp.responseText;
				if(initResponse != "success")
					document.getElementById('ipxe-modal-body').innerHTML = initResponse;
				else {
					document.getElementById('ipxe-modal-body').innerHTML = "{{lang_success}}: ipxe." + extension;
                    document.getElementById('download-btn').setAttribute('onclick','downloadIpxe(\''+extension+'\')');
					$("#download-btn").prop("disabled",false);
				}
			}
		}
		xmlhttp.send();
	}

    function downloadIpxe(extension) {
        console.log("TESTE");
        console.log(extension);
		window.location = "?do=ServerSetup&download=" + extension;
	}
</script>
